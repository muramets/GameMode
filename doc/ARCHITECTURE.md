# üèóÔ∏è RPG Therapy v1.0 - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

*–û–±–ª–∞—á–Ω–∞—è –º—É–ª—å—Ç–∏-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞*

---

## üåü –û–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

RPG Therapy v1.0 - —ç—Ç–æ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è –æ–±–ª–∞—á–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –≥–µ–π–º–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ª–∏—á–Ω–æ–≥–æ —Ä–∞–∑–≤–∏—Ç–∏—è, —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–∞—è –≤ –ø—Ä–æ–¥–∞–∫—à–Ω-—Å—Ä–µ–¥–µ. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–ª–æ—Å—å –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏ –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ –¥–æ—Å—Ç—É–ø–Ω—É—é –º—É–ª—å—Ç–∏-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫—É—é –ø–ª–∞—Ç—Ñ–æ—Ä–º—É —Å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π –æ–±–ª–∞—á–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π.

## ‚òÅÔ∏è –û–±–ª–∞—á–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ v1.0

### üåê –°—Ö–µ–º–∞ –¥–µ–ø–ª–æ–π–º–µ–Ω—Ç–∞

```
üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (–ª—é–±–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ)
    ‚Üì HTTPS
üåê GitHub Pages (Frontend Hosting)
    ‚Üì OAuth Flow
üîê Firebase Auth (Google Authentication)
    ‚Üì JWT Tokens
üöÇ Railway (Backend API)
    ‚Üì Encrypted Connection  
üíæ MongoDB Atlas (Cloud Database)
```

### üèõÔ∏è –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

#### 1. üåê **Frontend Layer** - GitHub Pages
**URL**: `https://muramets.github.io/GameMode`

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:**
- –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Ö–æ—Å—Ç–∏–Ω–≥ HTML/CSS/JS —Ñ–∞–π–ª–æ–≤
- CDN –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- SSL/TLS —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
- –ì–ª–æ–±–∞–ª—å–Ω–∞—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:**
- Vanilla JavaScript ES6+
- CSS3 —Å CSS Grid/Flexbox
- HTML5 Semantic Markup
- Progressive Web App –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å

#### 2. üîê **Authentication Layer** - Firebase Auth
**Project**: `gamemode-ea510`

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:**
- Google OAuth –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- JWT —Ç–æ–∫–µ–Ω—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏—è/–≤–∞–ª–∏–¥–∞—Ü–∏—è
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
- –ú—É–ª—å—Ç–∏-–¥–µ–≤–∞–π—Å –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- –ó–∞—â–∏—Ç–∞ –æ—Ç CSRF –∞—Ç–∞–∫
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Firebase Admin SDK

#### 3. üöÇ **Backend Layer** - Railway
**URL**: `https://rpg-therapy-backend-production.up.railway.app`

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:**
- REST API –¥–ª—è CRUD –æ–ø–µ—Ä–∞—Ü–∏–π
- –í–∞–ª–∏–¥–∞—Ü–∏—è JWT —Ç–æ–∫–µ–Ω–æ–≤
- –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å MongoDB

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ API:**
```javascript
// –û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
GET    /api/user/data     // –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
POST   /api/user/data     // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
GET    /api/user/history  // –ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –¥–µ–π—Å—Ç–≤–∏–π
POST   /api/user/history  // –î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å –≤ –∏—Å—Ç–æ—Ä–∏—é
DELETE /api/user/history/:id // –£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å –∏—Å—Ç–æ—Ä–∏–∏
GET    /api/test          // Health check
```

#### 4. üíæ **Database Layer** - MongoDB Atlas
**Cluster**: `gamemode-ea510`

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:**
- –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã
- –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–π:**
```javascript
// –ö–æ–ª–ª–µ–∫—Ü–∏—è: users
{
  _id: ObjectId,
  firebaseUid: String,    // –°–≤—è–∑—å —Å Firebase Auth
  email: String,
  displayName: String,
  createdAt: Date,
  updatedAt: Date,
  userData: {             // –í—Å–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    innerfaces: [...],
    protocols: [...],
    states: [...],
    checkins: [...]
  }
}
```

## üì± –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### üß© –ú–æ–¥—É–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞

```
js/
‚îú‚îÄ‚îÄ app.js              // üöÄ –ì–ª–∞–≤–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ + Auth
‚îú‚îÄ‚îÄ storage.js          // üíæ –ì–∏–±—Ä–∏–¥–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ (Local + Cloud)
‚îú‚îÄ‚îÄ ui.js              // üé® –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
‚îú‚îÄ‚îÄ modals.js          // üñºÔ∏è –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
‚îú‚îÄ‚îÄ dragdrop.js        // üñ±Ô∏è Drag & Drop —Å–∏—Å—Ç–µ–º–∞
‚îú‚îÄ‚îÄ api-client.js      // üì° HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è API
‚îú‚îÄ‚îÄ firebase-auth.js   // üîê Firebase –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
‚îî‚îÄ‚îÄ data.js           // üìä –ù–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
```

### üîÑ –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö –≤ v1.0

#### –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
```javascript
1. DOM Ready ‚Üí app.js –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
2. Firebase Auth –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è
3. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —ç–∫—Ä–∞–Ω –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ Google OAuth
5. Firebase –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JWT —Ç–æ–∫–µ–Ω
6. Storage.init() –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ
7. syncUserData() –∑–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ –æ–±–ª–∞–∫–∞
8. UI —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
```

#### –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è (check-in):
```javascript
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É –ø—Ä–æ—Ç–æ–∫–æ–ª–∞
2. app.checkin() –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ
3. Storage.addCheckin() –æ–±–Ω–æ–≤–ª—è–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
4. UI –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è (optimistic update)
5. apiClient.saveUserData() –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ –æ–±–ª–∞–∫–æ
6. –ü—Ä–∏ –æ—à–∏–±–∫–µ - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ + retry –ª–æ–≥–∏–∫–∞
```

## üõ°Ô∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### üîê –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –∑–∞—â–∏—Ç–∞

#### 1. **Authentication Flow**
```
Google OAuth ‚Üí Firebase Auth ‚Üí JWT Token ‚Üí Backend Validation
```

#### 2. **Authorization Model**
- –ö–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ
- JWT —Ç–æ–∫–µ–Ω—ã —Å–æ–¥–µ—Ä–∂–∞—Ç Firebase UID
- Backend –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–∫–µ–Ω –Ω–∞ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ
- MongoDB –∑–∞–ø—Ä–æ—Å—ã —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è –ø–æ firebaseUid

#### 3. **Network Security**
- HTTPS –≤–µ–∑–¥–µ (–ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ)
- CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è github.io
- MongoDB –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ —Å Railway IP
- –ù–µ—Ç –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –±–∞–∑–µ –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞

#### 4. **Data Security**
- –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ –ø–æ–∫–æ–µ (MongoDB Atlas)
- –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –≤ –ø–µ—Ä–µ–¥–∞—á–µ (HTTPS/TLS)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã —Å —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ–º
- –†–æ—Ç–∞—Ü–∏—è –∫–ª—é—á–µ–π (Firebase/MongoDB)

## üíæ –ì–∏–±—Ä–∏–¥–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è

### üîÑ LocalStorage + Cloud Sync

**–ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã:**
1. **Optimistic Updates**: –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ
2. **Background Sync**: –¥–∞–Ω–Ω—ã–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è —Å –æ–±–ª–∞–∫–æ–º
3. **Conflict Resolution**: –ø—Ä–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞—Ö –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç —É –æ–±–ª–∞—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
4. **Offline Mode**: –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:**
```javascript
class Storage {
  // –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ (–±—ã—Å—Ç—Ä–æ–µ)
  setLocal(key, value) {
    localStorage.setItem(this.getUserKey(key), JSON.stringify(value));
  }
  
  // –û–±–ª–∞—á–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è (–Ω–∞–¥–µ–∂–Ω–∞—è)
  async syncWithCloud() {
    try {
      const localData = this.getAllUserData();
      await apiClient.saveUserData(localData);
      this.markAsSynced();
    } catch (error) {
      this.scheduleRetry();
    }
  }
}
```

## üéÆ –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞

### üìä –û—Å–Ω–æ–≤–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ (Domain Model)

#### 1. **Innerfaces (–ù–∞–≤—ã–∫–∏)**
```javascript
interface Innerface {
  id: InnerfaceId;
  name: string;           // "–ù–∞–∑–≤–∞–Ω–∏–µ. –û–ø–∏—Å–∞–Ω–∏–µ"
  icon: string;           // –≠–º–æ–¥–∑–∏ –∏–∫–æ–Ω–∫–∞
  hover: string;          // –ü–æ–¥—Å–∫–∞–∑–∫–∞
  initialScore: number;   // –ù–∞—á–∞–ª—å–Ω—ã–π –±–∞–ª–ª (0-10)
  // currentScore –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏
}
```

#### 2. **Protocols (–ü—Ä–æ—Ç–æ–∫–æ–ª—ã)**
```javascript
interface Protocol {
  id: ProtocolId;
  name: string;           // "–ù–∞–∑–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è"
  icon: string;           // –≠–º–æ–¥–∑–∏
  hover: string;          // –û–ø–∏—Å–∞–Ω–∏–µ
  action: '+' | '-';      // –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ/–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ
  weight: number;         // –í–ª–∏—è–Ω–∏–µ (0-1)
  targets: InnerfaceId[];     // –¶–µ–ª–µ–≤—ã–µ –Ω–∞–≤—ã–∫–∏ (1-3)
}
```

#### 3. **States (–°–æ—Å—Ç–æ—è–Ω–∏—è)**
```javascript
interface State {
  id: StateId;
  name: string;           // "–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–æ–ª–∏/—Å–æ—Å—Ç–æ—è–Ω–∏—è"
  icon: string;           // –≠–º–æ–¥–∑–∏
  innerfaceIds: InnerfaceId[];    // –ù–∞–≤—ã–∫–∏ –≤ —Å–æ—Å—Ç–∞–≤–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
  stateIds: StateId[];    // –ó–∞–≤–∏—Å–∏–º—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
  // level –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –∫–∞–∫ —Å—Ä–µ–¥–Ω–µ–µ –æ—Ç —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –Ω–∞–≤—ã–∫–æ–≤
}
```

#### 4. **History Events (–°–æ–±—ã—Ç–∏—è)**
```javascript
interface HistoryEntry {
  id: string;             // timestamp-based ID
  type: 'protocol' | 'drag_drop' | 'quick_action';
  timestamp: ISOString;
  protocolId?: ProtocolId;
  changes?: Record<InnerfaceId, number>;
  // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
}
```

### üßÆ –°–∏—Å—Ç–µ–º–∞ —Ä–∞—Å—á–µ—Ç–æ–≤

#### –†–∞—Å—á–µ—Ç —Ç–µ–∫—É—â–µ–≥–æ —É—Ä–æ–≤–Ω—è –Ω–∞–≤—ã–∫–∞:
```javascript
calculateCurrentScore(innerfaceId) {
  const innerface = this.getInnerfaceById(innerfaceId);
  const history = this.getCheckins();
  
  const totalChange = history
    .filter(entry => entry.changes && entry.changes[innerfaceId])
    .reduce((sum, entry) => sum + entry.changes[innerfaceId], 0);
    
  return Math.max(0, innerface.initialScore + totalChange);
}
```

#### –†–∞—Å—á–µ—Ç —É—Ä–æ–≤–Ω—è —Å–æ—Å—Ç–æ—è–Ω–∏—è:
```javascript
calculateStateScore(stateId) {
  const state = this.getStateById(stateId);
  
  // –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π —Ä–∞—Å—á–µ—Ç –¥–ª—è –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π
  const innerfaceScores = state.innerfaceIds.map(id => this.calculateCurrentScore(id));
  const stateScores = state.stateIds.map(id => this.calculateStateScore(id));
  
  const allScores = [...innerfaceScores, ...stateScores];
  return allScores.reduce((sum, score) => sum + score, 0) / allScores.length;
}
```

## üîÑ API Architecture

### üì° RESTful Design

**–ë–∞–∑–æ–≤—ã–π URL**: `https://rpg-therapy-backend-production.up.railway.app/api`

#### Authentication Middleware:
```javascript
async function authenticateUser(req, res, next) {
  const token = req.headers.authorization?.replace('Bearer ', '');
  
  try {
    const decodedToken = await admin.auth().verifyIdToken(token);
    req.user = { uid: decodedToken.uid, email: decodedToken.email };
    next();
  } catch (error) {
    res.status(401).json({ error: 'Unauthorized' });
  }
}
```

#### Data Model –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
```javascript
const userSchema = new mongoose.Schema({
  firebaseUid: { type: String, required: true, unique: true },
  email: { type: String, required: true },
  displayName: String,
  userData: {
    innerfaces: [innerfaceSchema],
    protocols: [protocolSchema],
    states: [stateSchema],
    checkins: [checkinSchema]
  }
}, { timestamps: true });
```

## üé® UI Architecture

### üì± Responsive Design System

**–ë—Ä–µ–π–∫–ø–æ–∏–Ω—Ç—ã:**
- Mobile: < 768px
- Tablet: 768px - 1024px  
- Desktop: > 1024px

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```css
/* –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã */
.nav-container { /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */ }
.page-container { /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Å—Ç—Ä–∞–Ω–∏—Ü */ }
.card { /* –ö–∞—Ä—Ç–æ—á–∫–∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */ }
.modal { /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */ }
.progress-bar { /* –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä—ã */ }
```

### üñ±Ô∏è Drag & Drop System

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è:**
```javascript
class DragDropSystem {
  setupProtocols() {
    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ drag & drop –¥–ª—è –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤
  }
  
  setupInnerfaces() {
    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è –Ω–∞–≤—ã–∫–æ–≤
  }
  
  setupQuickActions() {
    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è Quick Actions
  }
  
  // –ï–¥–∏–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏
  handleDrop(sourceId, targetPosition, type) {
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Ä—è–¥–∫–∞ + –∏—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏
  }
}
```

## üìä Performance & Scalability

### ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∫–ª–∏–µ–Ω—Ç–∞

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
- Lazy loading –¥–ª—è –±–æ–ª—å—à–∏—Ö —Å–ø–∏—Å–∫–æ–≤
- Debounced –ø–æ–∏—Å–∫ (300ms)
- Optimistic updates –¥–ª—è UI
- –ú–µ–º–æ–∏–∑–∞—Ü–∏—è –≤—ã—á–∏—Å–ª–µ–Ω–∏–π –Ω–∞–≤—ã–∫–æ–≤
- –í–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –±–æ–ª—å—à–∏—Ö –∏—Å—Ç–æ—Ä–∏–π

### üåê –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã

**–¢–µ–∫—É—â–∏–µ –ª–∏–º–∏—Ç—ã:**
- MongoDB Atlas Free: 512MB (‚âà20,000 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
- Railway: $5/–º–µ—Å—è—Ü –¥–ª—è production
- Firebase Auth: 10,000 –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π/–º–µ—Å—è—Ü (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)
- GitHub Pages: –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞

**–ü–ª–∞–Ω—ã –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è:**
1. **–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ**: Railway –∞–≤—Ç–æ–º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
2. **–í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ**: MongoDB Atlas –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–∞
3. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: Redis –¥–ª—è –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
4. **CDN**: Cloudflare –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏

## üõ†Ô∏è Development Workflow

### üîÑ CI/CD Pipeline

```
üìù Code Push ‚Üí GitHub
    ‚Üì
üîç GitHub Actions ‚Üí Tests & Linting
    ‚Üì
üöÄ Auto Deploy ‚Üí GitHub Pages (Frontend)
    ‚Üì
üîó Webhook ‚Üí Railway (Backend)
    ‚Üì
‚úÖ Production Live
```

### üìÅ –ú–æ–¥—É–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

**–ü—Ä–∏–Ω—Ü–∏–ø—ã:**
- Single Responsibility Principle
- Dependency Injection
- Event-driven Architecture
- Clean Code practices

**–§–∞–π–ª–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
rpg-therapy/
‚îú‚îÄ‚îÄ index.html              // –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ css/                    // –°—Ç–∏–ª–∏
‚îÇ   ‚îî‚îÄ‚îÄ style.css
‚îú‚îÄ‚îÄ js/                     // JavaScript –º–æ–¥—É–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ app.js             // Main app controller
‚îÇ   ‚îú‚îÄ‚îÄ storage.js         // Data management
‚îÇ   ‚îú‚îÄ‚îÄ ui.js              // UI rendering
‚îÇ   ‚îú‚îÄ‚îÄ api-client.js      // HTTP client
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ doc/                   // –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îî‚îÄ‚îÄ firebase-config.js     // Firebase –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
```

## üîÆ Future Architecture Improvements

### üéØ –ü–ª–∞–Ω–∏—Ä—É–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è v1.1+

#### 1. **TypeScript Migration**
- –°—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è –¥–ª—è –ª—É—á—à–µ–≥–æ DX
- –ê–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∏ –æ—à–∏–±–∫–∏ –Ω–∞ —ç—Ç–∞–ø–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- –õ–µ–≥–∫–∏–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –±–æ–ª—å—à–∏—Ö –∫–æ–¥–æ–≤—ã—Ö –±–∞–∑

#### 2. **State Management**
- Redux/Zustand –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- Time-travel debugging
- Undo/Redo –∏–∑ –∫–æ—Ä–æ–±–∫–∏

#### 3. **Real-time Features**
- WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- Live collaboration (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- Push —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

#### 4. **Advanced Caching**
- Service Worker –¥–ª—è –æ—Ñ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º–∞
- Intelligent prefetching
- Background sync

#### 5. **Micro-frontend Architecture**
- –ù–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –º–æ–¥—É–ª–∏ –¥–ª—è –Ω–∞–≤—ã–∫–æ–≤/–ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤/—Å–æ—Å—Ç–æ—è–Ω–∏–π
- –û—Ç–¥–µ–ª—å–Ω—ã–µ deployment –ø–∞–π–ø–ª–∞–π–Ω—ã
- A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π

---

## üìã –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

RPG Therapy v1.0 –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—É—é –æ–±–ª–∞—á–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É, –∫–æ—Ç–æ—Ä–∞—è:

‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è** - –≥–æ—Ç–æ–≤–∞ –∫ —Ä–æ—Å—Ç—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π  
‚úÖ **–ù–∞–¥–µ–∂–Ω–∞** - –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏  
‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–∞** - enterprise-level –∑–∞—â–∏—Ç–∞ –¥–∞–Ω–Ω—ã—Ö  
‚úÖ **–ë—ã—Å—Ç—Ä–∞** - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏  
‚úÖ **–î–æ—Å—Ç—É–ø–Ω–∞** - —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö  
‚úÖ **Maintainable** - —á–∏—Å—Ç–∞—è –º–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞  

–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ–º—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –∏ –¥–∞–ª—å–Ω–µ–π—à–µ–º—É —Ä–∞–∑–≤–∏—Ç–∏—é.

---

*üìù –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞: –ò—é–Ω—å 2024*  
*üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≤–µ—Ä—Å–∏–∏: 1.0*  
*‚òÅÔ∏è –û–±–ª–∞—á–Ω–∞—è –º—É–ª—å—Ç–∏-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞* 